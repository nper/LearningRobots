from filter import train, predict

def validate(measurements, validation_frames):
    """Feed the measurements to the partcles filter to have it predict next frames
    to validate against the validation_frames"""

    num_frames = len(validation_frames)

    # Train the particles using measurements data
    print "Training..."
    particles = train(measurements)

    # Predict next frames using the trained particles
    print "Predict..."
    extra_frames = predict(particles, num_frames)

    # Compute sum of L^2 error
    l2_error = 0
    for actual, prediction in zip(validation_frames, extra_frames):
        x1, y1 = actual
        x2, y2 = prediction
        l2_error += (x2 - x1) ** 2 + (y2 - y1) ** 2

    return extra_frames, l2_error


if __name__ == '__main__':
    # data set (1) in minute-long-data.txt
    measurements = [[592,180],[583,189],[576,197],[569,205],[560,214],[551,225],[543,236],[537,246],[532,257],[528,267],[525,278],[524,287],[522,300],[522,311],[522,322],[523,334],[525,346],[526,355],[529,368],[533,378],[537,390],[542,399],[545,405],[546,404],[547,403],[549,405],[557,420],[557,406],[568,410],[580,410],[590,410],[600,410],[600,408],[616,408],[632,408],[647,402],[650,400],[653,399],[656,398],[655,406],[657,404],[657,410],[674,420],[672,413],[664,397],[676,417],[676,417],[663,412],[665,416],[667,416],[669,416],[671,416],[674,417],[664,416],[655,416],[656,414],[657,413],[672,408],[674,398],[671,391],[668,385],[667,376],[666,367],[656,354],[651,342],[647,333],[641,322],[637,314],[632,304],[636,303],[620,285],[614,275],[609,266],[603,254],[597,243],[591,233],[586,221],[580,210],[575,198],[569,187],[564,177],[559,166],[553,156],[548,144],[543,133],[538,121],[533,110],[529,101],[528,106],[523,112],[514,114],[505,117],[494,121],[484,125],[474,130],[464,137],[456,143],[447,152],[439,161],[433,171],[428,181],[423,191],[419,202],[415,213],[411,224],[408,237],[404,247],[400,259],[396,270],[392,281],[388,290],[383,301],[379,311],[375,321],[370,332],[366,342],[361,354],[357,366],[352,378],[348,390],[343,402],[341,406],[340,402],[337,401],[332,403],[325,406],[302,416],[309,411],[301,408],[292,404],[284,398],[277,393],[268,385],[262,376],[255,365],[250,356],[245,342],[241,331],[238,318],[235,305],[232,293],[230,281],[227,269],[224,259],[220,245],[217,233],[214,222],[211,210],[208,199],[204,187],[201,175],[197,161],[194,147],[191,133],[188,120],[185,106],[183,98],[179,103],[176,108],[171,109],[165,106],[163,104],[166,100],[164,97],[162,94],[160,91],[161,90],[162,89],[163,88],[164,87],[164,86],[165,84],[164,82],[166,85],[165,95],[163,103],[161,110],[164,114],[164,119],[165,123],[168,129],[166,138],[163,148],[161,159],[160,170],[159,181],[159,192],[161,203],[162,214],[164,226],[167,237],[169,248],[172,258],[176,268],[179,278],[182,290],[186,301],[188,313],[191,326],[194,337],[196,349],[197,361],[198,374],[198,385],[197,397],[208,392],[200,398],[200,395],[195,394],[186,393],[166,384],[167,387],[161,390],[165,392],[165,380],[165,371],[167,359],[170,347],[174,334],[180,322],[186,309],[195,296],[201,284],[209,274],[217,264],[226,255],[235,246],[245,236],[254,227],[263,219],[272,209],[280,201],[287,192],[296,183],[305,172],[314,162],[323,152],[331,142],[338,133],[347,122],[354,112],[361,102],[366,96],[368,102],[373,104],[381,104],[392,104],[403,103],[414,104],[427,105],[439,107],[452,111],[465,116],[477,121],[488,127],[500,133],[511,140],[523,148],[534,155],[544,162],[555,169],[565,175],[575,181],[586,188],[596,195],[607,203],[617,210],[628,218],[638,225],[649,232],[658,238],[661,242],[655,244],[651,247],[647,256],[642,265],[636,274],[629,283],[622,291],[615,298],[606,307],[598,314],[587,323],[576,334],[565,344],[555,353],[546,362],[536,372],[527,380],[517,389],[506,396],[493,404],[482,409],[473,413],[460,417],[451,419],[444,417],[436,414],[427,411],[414,410],[403,410],[392,411],[381,413],[370,415],[360,416],[351,416],[341,417],[330,417],[318,417],[305,417],[294,418],[296,422],[281,422],[266,416],[257,415],[246,414],[232,411],[220,410],[208,408],[196,406],[185,404],[172,403],[166,402],[169,399],[171,404],[171,403],[170,402],[165,402],[169,397],[169,397],[169,397],[169,397],[167,397],[161,399],[158,401],[156,404],[154,407],[160,418],[156,401],[166,411],[176,415],[192,417],[203,417],[216,417],[226,417],[237,416],[248,416],[259,416],[271,415],[284,415],[298,415],[313,414],[326,412],[340,412],[354,411],[366,410],[379,409],[391,408],[402,406],[414,406],[427,405],[439,405],[452,405],[464,405],[474,406],[485,406],[496,406],[507,407],[518,407],[530,407],[541,406],[550,406],[562,404],[571,403],[582,401],[593,399],[604,398],[613,396],[623,395],[634,394],[645,393],[655,392],[655,390],[655,389],[660,390],[656,377],[660,376],[652,358],[648,349],[643,338],[639,326],[633,315],[629,304],[628,303],[617,276],[612,265],[607,254],[602,245],[597,235],[592,224],[586,215],[580,205],[574,196],[567,188],[560,180],[540,166],[532,160],[533,160],[523,154],[514,148],[503,144],[491,140],[481,138],[470,135],[459,132],[449,131],[437,128],[426,127],[416,125],[405,124],[394,123],[383,122],[372,122],[360,121],[349,120],[337,120],[327,120],[315,120],[305,121],[294,122],[281,124],[270,126],[259,129],[249,133],[239,137],[231,142],[222,147],[215,153],[206,161],[198,168],[192,176],[185,184],[179,192],[173,202],[168,213],[163,222],[158,234],[154,245],[152,255],[150,264],[149,273],[149,283],[149,291],[151,299],[153,310],[155,317],[158,327],[163,336],[168,344],[173,351],[179,358],[187,365],[194,371],[202,376],[201,380],[219,385],[229,390],[227,392],[251,400],[262,404],[273,409],[298,416],[295,415],[305,417],[315,418],[324,418],[335,419],[347,418],[357,418],[367,418],[377,416],[387,414],[397,412],[406,410],[416,407],[425,403],[435,398],[444,392],[453,386],[461,379],[469,372],[477,365],[485,357],[493,350],[501,343],[511,334],[519,327],[527,319],[537,311],[546,302],[556,294],[564,286],[573,278],[583,269],[592,260],[602,249],[610,239],[617,230],[624,219],[630,208],[636,199],[642,186],[647,175],[651,162],[655,150],[659,138],[663,126],[665,115],[669,103],[669,102],[656,102],[659,107],[650,104],[638,101],[626,98],[615,97],[603,95],[590,94],[578,92],[565,90],[552,89],[539,87],[527,86],[516,86],[504,86],[493,85],[483,86],[472,89],[460,93],[448,98],[438,103],[427,108],[415,114],[405,119],[394,125],[382,131],[370,136],[358,140],[346,145],[334,149],[321,153],[309,156],[295,158],[283,161],[271,164],[258,167],[245,169],[232,172],[220,174],[207,176],[193,178],[180,178],[168,178],[163,180],[164,183],[160,184],[162,184],[164,181],[170,174],[167,163],[170,156],[175,149],[181,141],[188,135],[197,129],[207,122],[218,115],[228,107],[238,99],[246,93],[248,98],[254,103],[262,109],[270,116],[279,125],[288,136],[297,147],[304,157],[311,168],[318,179],[324,189],[331,200],[337,211],[342,223],[348,235],[354,246],[360,257],[366,268],[371,278],[376,288],[382,298],[388,308],[394,318],[401,328],[408,339],[415,349],[421,358],[428,369],[435,377],[442,387],[450,396],[458,403],[464,406],[469,400],[476,397],[498,400],[495,395],[510,396],[525,397],[537,397],[550,395],[563,393],[574,391],[587,387],[597,384],[607,380],[618,375],[628,371],[638,367],[652,362],[658,360],[651,361],[648,363],[645,366],[646,375],[643,387],[638,399],[633,408],[632,409],[628,410],[622,409],[614,406],[607,403],[597,399],[587,393],[579,387],[570,380],[560,373],[552,366],[541,359],[531,353],[521,346],[510,340],[499,333],[489,327],[478,321],[468,315],[458,308],[447,301],[437,296],[426,290],[415,285],[402,279],[391,275],[379,271],[367,267],[355,264],[343,261],[331,258],[320,256],[306,254],[294,252],[282,250],[269,249],[257,248],[244,247],[233,245],[220,243],[208,242],[198,241],[188,239],[176,238],[165,236],[166,237],[168,237],[168,237],[164,235],[163,234],[166,231],[166,227],[164,220],[162,210],[159,199],[157,185],[155,172],[153,159],[151,149],[155,142],[160,134],[166,125],[171,117],[176,109],[182,102],[189,94],[192,92],[198,93],[206,96],[216,100],[225,106],[234,112],[244,121],[253,129],[261,139],[270,148],[277,158],[285,169],[291,179],[298,188],[304,198],[310,207],[315,219],[321,230],[325,240],[329,251],[333,263],[337,275],[340,286],[344,298],[348,308],[352,319],[355,330],[359,341],[364,353],[367,363],[371,375],[376,386],[381,398],[384,402],[387,396],[394,394],[404,391],[415,388],[425,383],[436,378],[446,372],[455,365],[463,356],[470,348],[477,338],[483,327],[487,316],[491,305],[495,293],[498,281],[501,270],[504,259],[507,248],[510,236],[514,224],[516,214],[519,203],[522,192],[524,181],[527,169],[531,156],[534,143],[537,131],[539,120],[541,107],[542,99],[542,101],[540,102],[535,101],[526,101],[504,110],[506,104],[494,107],[484,112],[473,118],[463,124],[453,132],[443,141],[435,148],[427,156],[419,164],[411,174],[404,183],[397,193],[390,203],[384,213],[379,225],[375,236],[372,246],[370,258],[368,270],[366,281],[364,293],[363,304],[361,316],[360,329],[359,341],[357,354],[356,366],[356,377],[355,390],[354,400],[355,402],[355,400],[353,400],[351,401],[348,405],[344,408],[340,407],[335,407],[327,406],[320,406],[310,405],[301,404],[290,402],[279,400],[268,397],[257,394],[246,391],[235,388],[223,384],[212,381],[200,378],[189,375],[178,372],[169,369],[172,367],[175,363],[166,344],[177,347],[178,335],[182,321],[185,309],[188,296],[193,282],[199,270],[204,259],[210,248],[219,237],[226,227],[234,217],[241,208],[248,198],[255,188],[263,177],[269,167],[282,154],[280,144],[285,133],[289,122],[292,110],[296,98],[296,103],[294,105],[293,107],[290,106],[283,99],[277,93],[272,91],[267,94],[259,96],[249,98],[237,101],[226,104],[216,108],[205,112],[193,116],[183,120],[172,124],[165,128],[166,131],[166,136],[164,143],[161,152],[159,163],[156,174],[156,184],[154,195],[153,205],[153,215],[153,227],[154,237],[154,248],[155,257],[156,268],[156,278],[156,289],[156,301],[157,310],[156,321],[155,332],[154,341],[155,350],[157,358],[160,367],[164,376],[169,386],[169,394],[172,400],[175,407],[173,401],[176,402],[174,404],[172,406],[166,406],[160,406],[159,404],[158,403],[166,401],[174,400],[170,384],[174,372],[178,361],[183,349],[189,338],[196,327],[204,316],[213,305],[222,295],[232,285],[241,276],[251,268],[262,261],[274,255],[285,249],[297,244],[308,240],[320,235],[332,231],[344,226],[355,222],[367,216],[377,211],[389,204],[401,199],[412,193],[424,188],[434,182],[446,177],[457,172],[468,167],[480,163],[492,159],[503,155],[515,151],[527,147],[539,142],[551,139],[563,135],[575,130],[586,126],[597,122],[608,118],[620,114],[642,108],[642,105],[653,100],[662,95],[664,92],[665,91],[663,92],[663,95],[667,99],[671,105],[673,110],[674,117],[677,123],[675,127],[672,133],[669,140],[665,149],[661,159],[657,168],[651,178],[644,200],[643,198],[639,209],[635,220],[631,232],[626,243],[621,255],[615,267],[610,277],[604,287],[597,298],[591,307],[584,318],[575,329],[567,338],[558,348],[550,357],[541,365],[533,373],[523,381],[515,389],[507,396],[498,405],[492,409],[488,407],[480,403],[472,399],[464,393],[455,384],[447,377],[439,366],[432,357],[425,346],[418,335],[412,323],[405,312],[399,300],[393,291],[387,281],[381,270],[375,260],[369,249],[363,239],[357,227],[352,215],[346,203],[341,191],[335,177],[330,164],[326,153],[322,140],[318,127],[315,113],[312,101],[311,104],[312,108],[317,111],[325,114],[332,118],[339,122],[347,129],[354,138],[360,146],[366,157],[372,169],[377,182],[382,195],[387,207],[390,219],[392,230],[395,241],[396,251],[397,262],[397,274],[396,285],[394,296],[392,308],[389,320],[385,331],[380,342],[374,352],[368,362],[360,371],[352,380],[345,388],[337,396],[328,404],[321,410],[316,410],[309,410],[302,411],[291,411],[281,411],[270,410],[259,408],[246,404],[235,400],[222,394],[211,388],[202,382],[192,373],[183,362],[175,353],[168,342],[163,332],[158,320],[153,309],[152,301],[153,295],[158,289],[162,283],[167,273],[170,266],[174,257],[179,246],[185,234],[191,223],[204,200],[204,200],[210,189],[216,179],[224,168],[230,158],[236,148],[243,139],[249,129],[256,117],[259,110],[263,104],[267,98],[269,100],[271,98],[273,96],[275,100],[280,100],[290,102],[300,104],[310,108],[319,111],[330,117],[339,123],[348,129],[357,136],[367,144],[377,151],[386,158],[396,165],[406,172],[415,179],[425,186],[435,194],[444,201],[454,209],[463,218],[471,226],[480,236],[488,245],[494,255],[500,264],[505,275],[509,286],[512,297],[514,310],[516,324],[518,336],[520,348],[522,359],[523,371],[524,383],[526,394],[527,402],[529,401],[530,398],[527,398],[519,401],[512,404],[503,408],[494,412],[485,416],[479,418],[467,417],[458,415],[446,412],[435,410],[421,408],[407,406],[394,406],[382,406],[370,407],[360,408],[349,409],[338,411],[328,413],[320,415],[313,413],[303,408],[294,404],[286,399],[277,393],[269,386],[261,379],[254,372],[246,363],[237,352],[230,344],[222,336],[213,326],[205,318],[196,310],[188,302],[179,294],[169,286],[162,280],[163,278],[163,276],[162,274],[161,271],[162,269],[161,269],[163,269],[163,277],[167,287],[176,295],[182,300],[190,305],[200,307],[210,307],[222,307],[233,305],[246,302],[258,299],[268,296],[280,292],[291,288],[303,284],[314,280],[325,275],[337,270],[349,265],[359,261],[371,255],[382,250],[394,244],[407,238],[418,232],[429,226],[439,220],[448,215],[458,209],[468,202],[478,195],[487,188],[495,181],[504,173],[512,164],[519,155],[526,146],[533,135],[539,125],[544,115],[550,105],[555,97],[557,100],[562,103],[570,105],[579,108],[588,114],[599,121],[608,126],[617,133],[626,140],[634,147],[643,155],[653,162],[662,170],[663,172],[659,172],[655,179],[650,186],[643,195],[635,203],[625,211],[608,224],[598,232],[596,235],[587,243],[579,250],[570,257],[560,264],[551,271],[540,278],[530,284],[519,289],[507,294],[495,298],[482,302],[471,304],[459,306],[445,308],[434,310],[422,311],[409,312],[397,313],[387,314],[376,314],[365,316],[354,316],[341,318],[329,319],[318,320],[307,321],[295,322],[282,322],[269,323],[258,323],[245,324],[233,324],[220,324],[209,323],[197,322],[185,322],[172,322],[167,322],[158,330],[172,326],[172,334],[173,345],[175,354],[181,366],[186,375],[194,386],[203,397],[210,405],[213,405],[218,401],[224,397],[229,398],[237,400],[245,405],[251,405],[257,406],[264,407],[272,404],[280,404],[287,405],[295,404],[304,406],[312,409],[321,409],[330,411],[340,412],[349,413],[360,412],[370,411],[381,409],[392,407],[402,405],[412,403],[424,400],[435,397],[447,394],[459,392],[472,390],[484,388],[497,386],[510,384],[521,382],[531,380],[543,377],[556,375],[568,373],[581,371],[593,370],[606,368],[618,367],[631,365],[641,362],[653,360],[659,359],[656,362],[656,365],[660,369],[663,373],[661,375],[661,380],[661,386],[662,392],[663,401],[662,403],[661,399],[659,398],[662,400],[642,412],[640,408],[644,412],[639,412],[634,413],[630,414],[605,409],[597,405],[587,398],[577,392],[568,384],[560,377],[553,370],[546,362],[539,354],[532,346],[525,338],[517,330],[508,323],[499,316],[491,309],[481,301],[472,294],[462,287],[453,280],[443,273],[434,267],[425,259],[416,251],[406,242],[397,233],[388,223],[381,213],[374,201],[368,190],[362,178],[358,167],[354,154],[350,142],[346,129],[342,117],[338,104],[337,100],[336,107],[337,106],[339,105],[341,105],[346,99],[353,94],[359,91],[366,89],[374,88],[383,88],[392,88],[399,90],[406,95],[417,101],[427,107],[436,112],[445,118],[454,126],[462,133],[469,142],[476,153],[482,162],[487,174],[491,185],[494,196],[498,207],[500,219]]
    validation_frames = [[501,233],[502,246],[503,257],[504,269],[506,281],[507,292],[508,305],[509,315],[509,326],[509,337],[508,348],[508,360],[507,372],[506,383],[505,395],[505,401],[507,400],[512,399],[518,400],[526,402],[537,404],[548,406],[562,407],[574,407],[585,406],[597,406],[607,405],[618,404],[629,404],[640,404],[652,404],[660,404],[670,406],[661,402],[659,406],[665,405],[664,401],[663,398],[657,400],[652,403],[654,408],[639,410],[624,413],[612,416],[601,418],[591,419],[574,422],[573,419],[566,419],[556,419],[545,418],[534,418],[522,419],[511,419],[501,418],[492,417],[483,416],[476,415],[464,414],[455,412]]

    extra_frames, l2_error = validate(measurements, validation_frames)

    print "Actual pos:", validation_frames
    print "Prediction:", extra_frames
    print "L^2 Error:", l2_error
